{"version":3,"sources":["../../../src/fields/PromptTextareaField/TextareaField.tsx"],"sourcesContent":["'use client'\n\nimport type { TextareaFieldProps } from '@payloadcms/ui'\n\nimport { TextareaField as InputField, useField, useFieldProps, useForm } from '@payloadcms/ui'\nimport React, { useCallback, useContext, useEffect, useRef } from 'react'\n\nimport { PromptContext } from '../../providers/Prompt/index.js'\nimport { Floatype } from '../../ui/Floatype/Floatype.js'\n\nexport const PromptTextareaField: React.FC<TextareaFieldProps> = (props) => {\n  const { name, path: pathFromProps, ...restProps } = props\n  const { path: pathFromContext } = useFieldProps()\n  const { fields } = useContext(PromptContext)\n  const elementRef = useRef<HTMLTextAreaElement>(null)\n\n  const { path, setValue } = useField<string>({\n    path: pathFromContext || pathFromProps || name,\n  })\n\n  const { formRef, initializing } = useForm()\n\n  useEffect(() => {\n    if (!formRef.current || elementRef.current) return\n\n    const fieldId = `#field-${path.replace(/\\./g, '__')}`\n    elementRef.current = formRef.current.querySelector(fieldId)\n  }, [formRef, path])\n\n  const handleQuery = useCallback(\n    (val: string) => {\n      if (val === '{{ ') return fields\n      return fields.filter((field) => field.toLowerCase().includes(val.toLowerCase()))\n    },\n    [fields],\n  )\n\n  const handleSelect = useCallback(\n    (value: string, query: string) => {\n      if (query === '{{ ') return `${value} }}`\n      return fields.includes(value) ? value : undefined\n    },\n    [fields],\n  )\n\n  const handleUpdate = useCallback(\n    (value: string) => {\n      if (value) setValue(value)\n    },\n    [setValue],\n  )\n\n  const CustomDescription = !initializing ? (\n    <Floatype\n      options={{\n        onQuery: handleQuery,\n        onSelect: handleSelect,\n        onUpdate: handleUpdate,\n      }}\n      ref={elementRef}\n    />\n  ) : null\n\n  return (\n    <InputField\n      {...restProps}\n      CustomDescription={CustomDescription}\n      name={name}\n      path={pathFromProps}\n    />\n  )\n}\n"],"names":["TextareaField","InputField","useField","useFieldProps","useForm","React","useCallback","useContext","useEffect","useRef","PromptContext","Floatype","PromptTextareaField","props","name","path","pathFromProps","restProps","pathFromContext","fields","elementRef","setValue","formRef","initializing","current","fieldId","replace","querySelector","handleQuery","val","filter","field","toLowerCase","includes","handleSelect","value","query","undefined","handleUpdate","CustomDescription","options","onQuery","onSelect","onUpdate","ref"],"mappings":"AAAA;;AAIA,SAASA,iBAAiBC,UAAU,EAAEC,QAAQ,EAAEC,aAAa,EAAEC,OAAO,QAAQ,iBAAgB;AAC9F,OAAOC,SAASC,WAAW,EAAEC,UAAU,EAAEC,SAAS,EAAEC,MAAM,QAAQ,QAAO;AAEzE,SAASC,aAAa,QAAQ,kCAAiC;AAC/D,SAASC,QAAQ,QAAQ,gCAA+B;AAExD,OAAO,MAAMC,sBAAoD,CAACC;IAChE,MAAM,EAAEC,IAAI,EAAEC,MAAMC,aAAa,EAAE,GAAGC,WAAW,GAAGJ;IACpD,MAAM,EAAEE,MAAMG,eAAe,EAAE,GAAGf;IAClC,MAAM,EAAEgB,MAAM,EAAE,GAAGZ,WAAWG;IAC9B,MAAMU,aAAaX,OAA4B;IAE/C,MAAM,EAAEM,IAAI,EAAEM,QAAQ,EAAE,GAAGnB,SAAiB;QAC1Ca,MAAMG,mBAAmBF,iBAAiBF;IAC5C;IAEA,MAAM,EAAEQ,OAAO,EAAEC,YAAY,EAAE,GAAGnB;IAElCI,UAAU;QACR,IAAI,CAACc,QAAQE,OAAO,IAAIJ,WAAWI,OAAO,EAAE;QAE5C,MAAMC,UAAU,CAAC,OAAO,EAAEV,KAAKW,OAAO,CAAC,OAAO,MAAM,CAAC;QACrDN,WAAWI,OAAO,GAAGF,QAAQE,OAAO,CAACG,aAAa,CAACF;IACrD,GAAG;QAACH;QAASP;KAAK;IAElB,MAAMa,cAActB,YAClB,CAACuB;QACC,IAAIA,QAAQ,OAAO,OAAOV;QAC1B,OAAOA,OAAOW,MAAM,CAAC,CAACC,QAAUA,MAAMC,WAAW,GAAGC,QAAQ,CAACJ,IAAIG,WAAW;IAC9E,GACA;QAACb;KAAO;IAGV,MAAMe,eAAe5B,YACnB,CAAC6B,OAAeC;QACd,IAAIA,UAAU,OAAO,OAAO,CAAC,EAAED,MAAM,GAAG,CAAC;QACzC,OAAOhB,OAAOc,QAAQ,CAACE,SAASA,QAAQE;IAC1C,GACA;QAAClB;KAAO;IAGV,MAAMmB,eAAehC,YACnB,CAAC6B;QACC,IAAIA,OAAOd,SAASc;IACtB,GACA;QAACd;KAAS;IAGZ,MAAMkB,oBAAoB,CAAChB,6BACzB,KAACZ;QACC6B,SAAS;YACPC,SAASb;YACTc,UAAUR;YACVS,UAAUL;QACZ;QACAM,KAAKxB;SAEL;IAEJ,qBACE,KAACnB;QACE,GAAGgB,SAAS;QACbsB,mBAAmBA;QACnBzB,MAAMA;QACNC,MAAMC;;AAGZ,EAAC"}