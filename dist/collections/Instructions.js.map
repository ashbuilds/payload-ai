{"version":3,"sources":["../../src/collections/Instructions.ts"],"sourcesContent":["import type { CollectionConfig, GroupField } from 'payload'\n\nimport { GenerationModels } from '../ai/models/index.js'\nimport { PLUGIN_INSTRUCTIONS_TABLE } from '../defaults.js'\nimport { PromptEditorField } from '../fields/PromptEditorField/PromptEditorField.js'\nimport { SelectField } from '../fields/SelectField/SelectField.js'\n\nconst groupSettings = GenerationModels.reduce((fields, model) => {\n  if (model.settings) {\n    fields.push(model.settings)\n  }\n  return fields\n}, [] as GroupField[])\n\nconst modelOptions = GenerationModels.map((model) => {\n  return {\n    fields: model.fields,\n    label: model.name,\n    value: model.id,\n  }\n})\n\nexport const Instructions: CollectionConfig = {\n  slug: PLUGIN_INSTRUCTIONS_TABLE,\n\n  // TODO: Revisit permissions, better if end user can provide this\n  access: {\n    create: () => true,\n    read: () => true,\n    update: () => true,\n  },\n  admin: {\n    hidden: true,\n  },\n  fields: [\n    {\n      name: 'schema-path',\n      type: 'text',\n      admin: {\n        hidden: true,\n        readOnly: true,\n      },\n      unique: true,\n    },\n    {\n      name: 'field-type',\n      type: 'select',\n      admin: {\n        hidden: true,\n        readOnly: true,\n      },\n      defaultValue: 'text',\n      label: 'Field type',\n      options: [\n        {\n          label: 'text',\n          value: 'text',\n        },\n        {\n          label: 'textarea',\n          value: 'textarea',\n        },\n        {\n          label: 'upload',\n          value: 'upload',\n        },\n        {\n          label: 'richText',\n          value: 'richText',\n        },\n      ],\n    },\n    {\n      name: 'model-id',\n      type: 'select',\n      admin: {\n        components: {\n          Field: SelectField,\n        },\n        custom: {\n          filterByField: 'field-type',\n          options: modelOptions,\n        },\n      },\n      label: 'Model',\n      options: modelOptions.map((option) => {\n        return {\n          label: option.label,\n          value: option.value,\n        }\n      }),\n      validate: () => true,\n    },\n    {\n      name: 'prompt',\n      type: 'textarea',\n      admin: {\n        components: {\n          Field: PromptEditorField,\n        },\n      },\n    },\n    ...groupSettings,\n  ],\n  hooks: {\n    beforeChange: [\n      (req) => {\n        if (req.data['openai-gpt-object-settings'].layout?.length === 0) {\n          // TODO: why??\n          req.data['openai-gpt-object-settings'].layout = ''\n        }\n        return req.data\n      },\n    ],\n  },\n}\n"],"names":["GenerationModels","PLUGIN_INSTRUCTIONS_TABLE","PromptEditorField","SelectField","groupSettings","reduce","fields","model","settings","push","modelOptions","map","label","name","value","id","Instructions","slug","access","create","read","update","admin","hidden","type","readOnly","unique","defaultValue","options","components","Field","custom","filterByField","option","validate","hooks","beforeChange","req","data","layout","length"],"mappings":"AAEA,SAASA,gBAAgB,QAAQ,wBAAuB;AACxD,SAASC,yBAAyB,QAAQ,iBAAgB;AAC1D,SAASC,iBAAiB,QAAQ,mDAAkD;AACpF,SAASC,WAAW,QAAQ,uCAAsC;AAElE,MAAMC,gBAAgBJ,iBAAiBK,MAAM,CAAC,CAACC,QAAQC;IACrD,IAAIA,MAAMC,QAAQ,EAAE;QAClBF,OAAOG,IAAI,CAACF,MAAMC,QAAQ;IAC5B;IACA,OAAOF;AACT,GAAG,EAAE;AAEL,MAAMI,eAAeV,iBAAiBW,GAAG,CAAC,CAACJ;IACzC,OAAO;QACLD,QAAQC,MAAMD,MAAM;QACpBM,OAAOL,MAAMM,IAAI;QACjBC,OAAOP,MAAMQ,EAAE;IACjB;AACF;AAEA,OAAO,MAAMC,eAAiC;IAC5CC,MAAMhB;IAEN,iEAAiE;IACjEiB,QAAQ;QACNC,QAAQ,IAAM;QACdC,MAAM,IAAM;QACZC,QAAQ,IAAM;IAChB;IACAC,OAAO;QACLC,QAAQ;IACV;IACAjB,QAAQ;QACN;YACEO,MAAM;YACNW,MAAM;YACNF,OAAO;gBACLC,QAAQ;gBACRE,UAAU;YACZ;YACAC,QAAQ;QACV;QACA;YACEb,MAAM;YACNW,MAAM;YACNF,OAAO;gBACLC,QAAQ;gBACRE,UAAU;YACZ;YACAE,cAAc;YACdf,OAAO;YACPgB,SAAS;gBACP;oBACEhB,OAAO;oBACPE,OAAO;gBACT;gBACA;oBACEF,OAAO;oBACPE,OAAO;gBACT;gBACA;oBACEF,OAAO;oBACPE,OAAO;gBACT;gBACA;oBACEF,OAAO;oBACPE,OAAO;gBACT;aACD;QACH;QACA;YACED,MAAM;YACNW,MAAM;YACNF,OAAO;gBACLO,YAAY;oBACVC,OAAO3B;gBACT;gBACA4B,QAAQ;oBACNC,eAAe;oBACfJ,SAASlB;gBACX;YACF;YACAE,OAAO;YACPgB,SAASlB,aAAaC,GAAG,CAAC,CAACsB;gBACzB,OAAO;oBACLrB,OAAOqB,OAAOrB,KAAK;oBACnBE,OAAOmB,OAAOnB,KAAK;gBACrB;YACF;YACAoB,UAAU,IAAM;QAClB;QACA;YACErB,MAAM;YACNW,MAAM;YACNF,OAAO;gBACLO,YAAY;oBACVC,OAAO5B;gBACT;YACF;QACF;WACGE;KACJ;IACD+B,OAAO;QACLC,cAAc;YACZ,CAACC;gBACC,IAAIA,IAAIC,IAAI,CAAC,6BAA6B,CAACC,MAAM,EAAEC,WAAW,GAAG;oBAC/D,cAAc;oBACdH,IAAIC,IAAI,CAAC,6BAA6B,CAACC,MAAM,GAAG;gBAClD;gBACA,OAAOF,IAAIC,IAAI;YACjB;SACD;IACH;AACF,EAAC"}