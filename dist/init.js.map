{"version":3,"sources":["../src/init.ts"],"sourcesContent":["export const init = async (payload, fieldSchemaPaths) => {\n  payload.logger.info(`— AI Plugin: Initializing...`)\n\n  const paths = Object.keys(fieldSchemaPaths)\n\n  const fieldInstructionsMap = {}\n  for (let i = 0; i < paths.length; i++) {\n    const path = paths[i]\n    const fieldType = fieldSchemaPaths[path]\n    const entry = await payload.find({\n      collection: 'instructions',\n      where: {\n        'field-type': {\n          equals: fieldType,\n        },\n        'schema-path': {\n          equals: path,\n        },\n      },\n    })\n\n    if (!entry?.docs?.length) {\n      const instructions = await payload.create({\n        collection: 'instructions',\n        data: {\n          'field-type': fieldType,\n          'schema-path': path,\n        },\n      })\n      fieldInstructionsMap[path] = instructions.id\n    } else {\n      const [instructions] = entry.docs\n      fieldInstructionsMap[path] = instructions.id\n    }\n  }\n\n  await payload.updateGlobal({\n    slug: 'ai-plugin__instructions_map', // required\n    data: {\n      map: fieldInstructionsMap,\n    },\n    depth: 2,\n  })\n  payload.logger.info(`— AI Plugin: Initialized!`)\n}\n"],"names":["init","payload","fieldSchemaPaths","logger","info","paths","Object","keys","fieldInstructionsMap","i","length","path","fieldType","entry","find","collection","where","equals","docs","instructions","create","data","id","updateGlobal","slug","map","depth"],"mappings":"AAAA,OAAO,MAAMA,OAAO,OAAOC,SAASC;IAClCD,QAAQE,MAAM,CAACC,IAAI,CAAC,CAAC,4BAA4B,CAAC;IAElD,MAAMC,QAAQC,OAAOC,IAAI,CAACL;IAE1B,MAAMM,uBAAuB,CAAC;IAC9B,IAAK,IAAIC,IAAI,GAAGA,IAAIJ,MAAMK,MAAM,EAAED,IAAK;QACrC,MAAME,OAAON,KAAK,CAACI,EAAE;QACrB,MAAMG,YAAYV,gBAAgB,CAACS,KAAK;QACxC,MAAME,QAAQ,MAAMZ,QAAQa,IAAI,CAAC;YAC/BC,YAAY;YACZC,OAAO;gBACL,cAAc;oBACZC,QAAQL;gBACV;gBACA,eAAe;oBACbK,QAAQN;gBACV;YACF;QACF;QAEA,IAAI,CAACE,OAAOK,MAAMR,QAAQ;YACxB,MAAMS,eAAe,MAAMlB,QAAQmB,MAAM,CAAC;gBACxCL,YAAY;gBACZM,MAAM;oBACJ,cAAcT;oBACd,eAAeD;gBACjB;YACF;YACAH,oBAAoB,CAACG,KAAK,GAAGQ,aAAaG,EAAE;QAC9C,OAAO;YACL,MAAM,CAACH,aAAa,GAAGN,MAAMK,IAAI;YACjCV,oBAAoB,CAACG,KAAK,GAAGQ,aAAaG,EAAE;QAC9C;IACF;IAEA,MAAMrB,QAAQsB,YAAY,CAAC;QACzBC,MAAM;QACNH,MAAM;YACJI,KAAKjB;QACP;QACAkB,OAAO;IACT;IACAzB,QAAQE,MAAM,CAACC,IAAI,CAAC,CAAC,yBAAyB,CAAC;AACjD,EAAC"}