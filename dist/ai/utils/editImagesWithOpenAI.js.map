{"version":3,"sources":["../../../src/ai/utils/editImagesWithOpenAI.ts"],"sourcesContent":["import type { ImageReference } from '../../types.js'\n\n/**\n * Send multiple images as `image[]` to OpenAI's image edit endpoint using gpt-image-1.\n * @param images\n * @param prompt Prompt to guide the image edit\n * @param model\n * @returns base64 string of the edited image\n * @note: Remove this function, once https://github.com/openai/openai-node/issues/1492 is fixed.\n */\nexport async function editImagesWithOpenAI(\n  images: ImageReference[],\n  prompt: string,\n  model: string = 'gpt-image-1',\n) {\n  try {\n    const formData = new FormData()\n\n    for (const [_, img] of images.entries()) {\n      const extension = img.data.type.split('/')[1]\n      formData.append('image[]', img.data, `${img.name}.${extension}`)\n    }\n\n    formData.append('prompt', prompt)\n    formData.append('model', model)\n\n    const baseURL = process.env.OPENAI_BASE_URL ?? 'https://api.openai.com/v1'\n    const openaiRes = await fetch(`${baseURL}/images/edits`, {\n      body: formData,\n      headers: {\n        Authorization: `Bearer ${process.env.OPENAI_API_KEY}`,\n        'OpenAI-Organization': process.env.OPENAI_ORG_ID || '',\n      },\n      method: 'POST',\n    })\n\n    if (!openaiRes.ok) {\n      const errorText = await openaiRes.text()\n      throw new Error(`OpenAI edit error: ${openaiRes.status} - ${errorText}`)\n    }\n\n    return openaiRes.json()\n  } catch (e) {\n    console.error('Error editing images: ', e)\n    throw Error(\n      'Image edit request failed. Please ensure the images are accessible and hosted publicly.',\n    )\n  }\n}\n"],"names":["editImagesWithOpenAI","images","prompt","model","formData","FormData","_","img","entries","extension","data","type","split","append","name","baseURL","process","env","OPENAI_BASE_URL","openaiRes","fetch","body","headers","Authorization","OPENAI_API_KEY","OPENAI_ORG_ID","method","ok","errorText","text","Error","status","json","e","console","error"],"mappings":"AAEA;;;;;;;CAOC,GACD,OAAO,eAAeA,qBACpBC,MAAwB,EACxBC,MAAc,EACdC,QAAgB,aAAa;IAE7B,IAAI;QACF,MAAMC,WAAW,IAAIC;QAErB,KAAK,MAAM,CAACC,GAAGC,IAAI,IAAIN,OAAOO,OAAO,GAAI;YACvC,MAAMC,YAAYF,IAAIG,IAAI,CAACC,IAAI,CAACC,KAAK,CAAC,IAAI,CAAC,EAAE;YAC7CR,SAASS,MAAM,CAAC,WAAWN,IAAIG,IAAI,EAAE,GAAGH,IAAIO,IAAI,CAAC,CAAC,EAAEL,WAAW;QACjE;QAEAL,SAASS,MAAM,CAAC,UAAUX;QAC1BE,SAASS,MAAM,CAAC,SAASV;QAEzB,MAAMY,UAAUC,QAAQC,GAAG,CAACC,eAAe,IAAI;QAC/C,MAAMC,YAAY,MAAMC,MAAM,GAAGL,QAAQ,aAAa,CAAC,EAAE;YACvDM,MAAMjB;YACNkB,SAAS;gBACPC,eAAe,CAAC,OAAO,EAAEP,QAAQC,GAAG,CAACO,cAAc,EAAE;gBACrD,uBAAuBR,QAAQC,GAAG,CAACQ,aAAa,IAAI;YACtD;YACAC,QAAQ;QACV;QAEA,IAAI,CAACP,UAAUQ,EAAE,EAAE;YACjB,MAAMC,YAAY,MAAMT,UAAUU,IAAI;YACtC,MAAM,IAAIC,MAAM,CAAC,mBAAmB,EAAEX,UAAUY,MAAM,CAAC,GAAG,EAAEH,WAAW;QACzE;QAEA,OAAOT,UAAUa,IAAI;IACvB,EAAE,OAAOC,GAAG;QACVC,QAAQC,KAAK,CAAC,0BAA0BF;QACxC,MAAMH,MACJ;IAEJ;AACF"}