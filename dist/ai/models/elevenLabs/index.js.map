{"version":3,"sources":["../../../../src/ai/models/elevenLabs/index.ts"],"sourcesContent":["import type { Field, File } from 'payload'\n\nimport type { GenerationConfig } from '../../../types.js'\nimport type { Voice } from './voices.js'\n\nimport { generateFileNameByPrompt } from '../../utils/generateFileNameByPrompt.js'\nimport { generateVoice } from './generateVoice.js'\nimport { getAllVoices } from './voices.js'\n\nconst { voices = [] }: { voices: Voice[] } = await getAllVoices()\n\nconst voiceOptions = voices.map((voice) => {\n  return {\n    label: voice.name ?? '',\n    value: voice.voice_id,\n    ...voice,\n  }\n})\n\nconst fieldVoiceOptions = voiceOptions.map((option) => {\n  return {\n    label: option.name ?? '',\n    value: option.voice_id,\n  }\n})\n\nconst fields: Field[] = [\n  {\n    type: 'collapsible',\n    admin: {\n      initCollapsed: false,\n    },\n    fields: [\n      {\n        name: 'stability',\n        type: 'number',\n        defaultValue: 0.5,\n        label: 'Stability',\n        max: 1,\n        min: 0,\n        required: true,\n      },\n      {\n        name: 'similarity_boost',\n        type: 'number',\n        defaultValue: 0.5,\n        label: 'Similarity Boost',\n        max: 1,\n        min: 0,\n        required: true,\n      },\n      {\n        name: 'style',\n        type: 'number',\n        defaultValue: 0.5,\n        label: 'Style',\n        max: 1,\n        min: 0,\n      },\n      {\n        name: 'use_speaker_boost',\n        type: 'checkbox',\n        label: 'Use Speaker Boost',\n      },\n    ],\n    label: 'Voice Settings',\n  },\n  {\n    name: 'seed',\n    type: 'number',\n    label: 'Seed',\n  },\n  {\n    type: 'row',\n    fields: [\n      {\n        name: 'previous_text',\n        type: 'textarea',\n        label: 'Previous Text',\n      },\n      {\n        name: 'next_text',\n        type: 'textarea',\n        label: 'Next Text',\n      },\n    ],\n  },\n]\n\nif (voiceOptions.length) {\n  fields.unshift({\n    name: 'voice_id',\n    type: 'select',\n    defaultValue: voiceOptions[0]?.voice_id,\n    label: 'Voice',\n    options: fieldVoiceOptions,\n    required: true,\n  })\n}\n\nconst MODEL_KEY = '11Labs'\n\nexport const ElevenLabsConfig: GenerationConfig = {\n  models: [\n    {\n      id: `${MODEL_KEY}-m-v2`,\n      name: 'ElevenLabs Multilingual v2',\n      fields: ['upload'],\n      handler: async (text: string, options) => {\n        const voiceData = await generateVoice(text, options)\n        if (!voiceData || !voiceData.buffer) {\n          throw new Error('Voice data missing')\n        }\n        return {\n          data: {\n            alt: 'voice over',\n          },\n          file: {\n            name: `voice_${generateFileNameByPrompt(text)}.mp3`,\n            data: voiceData.buffer,\n            mimetype: 'audio/mp3',\n            size: voiceData.buffer.byteLength,\n          } as File,\n        }\n      },\n      output: 'audio',\n      settings: {\n        name: `${MODEL_KEY}-settings`,\n        type: 'group',\n        admin: {\n          condition: (data) => {\n            return data['model-id'] === `${MODEL_KEY}-m-v2`\n          },\n        },\n        fields,\n        label: 'ElevenLabs Multilingual v2 Settings',\n      },\n    },\n  ],\n  provider: 'ElevenLabs',\n}\n"],"names":["generateFileNameByPrompt","generateVoice","getAllVoices","voices","voiceOptions","map","voice","label","name","value","voice_id","fieldVoiceOptions","option","fields","type","admin","initCollapsed","defaultValue","max","min","required","length","unshift","options","MODEL_KEY","ElevenLabsConfig","models","id","handler","text","voiceData","buffer","Error","data","alt","file","mimetype","size","byteLength","output","settings","condition","provider"],"mappings":"AAKA,SAASA,wBAAwB,QAAQ,0CAAyC;AAClF,SAASC,aAAa,QAAQ,qBAAoB;AAClD,SAASC,YAAY,QAAQ,cAAa;AAE1C,MAAM,EAAEC,SAAS,EAAE,EAAE,GAAwB,MAAMD;AAEnD,MAAME,eAAeD,OAAOE,GAAG,CAAC,CAACC;IAC/B,OAAO;QACLC,OAAOD,MAAME,IAAI,IAAI;QACrBC,OAAOH,MAAMI,QAAQ;QACrB,GAAGJ,KAAK;IACV;AACF;AAEA,MAAMK,oBAAoBP,aAAaC,GAAG,CAAC,CAACO;IAC1C,OAAO;QACLL,OAAOK,OAAOJ,IAAI,IAAI;QACtBC,OAAOG,OAAOF,QAAQ;IACxB;AACF;AAEA,MAAMG,SAAkB;IACtB;QACEC,MAAM;QACNC,OAAO;YACLC,eAAe;QACjB;QACAH,QAAQ;YACN;gBACEL,MAAM;gBACNM,MAAM;gBACNG,cAAc;gBACdV,OAAO;gBACPW,KAAK;gBACLC,KAAK;gBACLC,UAAU;YACZ;YACA;gBACEZ,MAAM;gBACNM,MAAM;gBACNG,cAAc;gBACdV,OAAO;gBACPW,KAAK;gBACLC,KAAK;gBACLC,UAAU;YACZ;YACA;gBACEZ,MAAM;gBACNM,MAAM;gBACNG,cAAc;gBACdV,OAAO;gBACPW,KAAK;gBACLC,KAAK;YACP;YACA;gBACEX,MAAM;gBACNM,MAAM;gBACNP,OAAO;YACT;SACD;QACDA,OAAO;IACT;IACA;QACEC,MAAM;QACNM,MAAM;QACNP,OAAO;IACT;IACA;QACEO,MAAM;QACND,QAAQ;YACN;gBACEL,MAAM;gBACNM,MAAM;gBACNP,OAAO;YACT;YACA;gBACEC,MAAM;gBACNM,MAAM;gBACNP,OAAO;YACT;SACD;IACH;CACD;AAED,IAAIH,aAAaiB,MAAM,EAAE;IACvBR,OAAOS,OAAO,CAAC;QACbd,MAAM;QACNM,MAAM;QACNG,cAAcb,YAAY,CAAC,EAAE,EAAEM;QAC/BH,OAAO;QACPgB,SAASZ;QACTS,UAAU;IACZ;AACF;AAEA,MAAMI,YAAY;AAElB,OAAO,MAAMC,mBAAqC;IAChDC,QAAQ;QACN;YACEC,IAAI,GAAGH,UAAU,KAAK,CAAC;YACvBhB,MAAM;YACNK,QAAQ;gBAAC;aAAS;YAClBe,SAAS,OAAOC,MAAcN;gBAC5B,MAAMO,YAAY,MAAM7B,cAAc4B,MAAMN;gBAC5C,IAAI,CAACO,aAAa,CAACA,UAAUC,MAAM,EAAE;oBACnC,MAAM,IAAIC,MAAM;gBAClB;gBACA,OAAO;oBACLC,MAAM;wBACJC,KAAK;oBACP;oBACAC,MAAM;wBACJ3B,MAAM,CAAC,MAAM,EAAER,yBAAyB6B,MAAM,IAAI,CAAC;wBACnDI,MAAMH,UAAUC,MAAM;wBACtBK,UAAU;wBACVC,MAAMP,UAAUC,MAAM,CAACO,UAAU;oBACnC;gBACF;YACF;YACAC,QAAQ;YACRC,UAAU;gBACRhC,MAAM,GAAGgB,UAAU,SAAS,CAAC;gBAC7BV,MAAM;gBACNC,OAAO;oBACL0B,WAAW,CAACR;wBACV,OAAOA,IAAI,CAAC,WAAW,KAAK,GAAGT,UAAU,KAAK,CAAC;oBACjD;gBACF;gBACAX;gBACAN,OAAO;YACT;QACF;KACD;IACDmC,UAAU;AACZ,EAAC"}