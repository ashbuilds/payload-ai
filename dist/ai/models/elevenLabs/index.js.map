{"version":3,"sources":["../../../../src/ai/models/elevenLabs/index.ts"],"sourcesContent":["import type { Field, File } from 'payload'\n\nimport type { GenerationConfig } from '../../../types.js'\n\nimport { SelectField } from '../../../fields/SelectField/SelectField.js'\nimport { generateFileNameByPrompt } from '../../utils/generateFileNameByPrompt.js'\nimport { generateVoice } from './generateVoice.js'\nimport { getAllVoices } from './voices.js'\n\nconst { voices = [] } = await getAllVoices()\n\nconst voiceOptions = voices.map((voice) => {\n  return {\n    label: voice.name,\n    value: voice.voice_id,\n    ...voice,\n  }\n})\n\nconst fieldVoiceOptions = voiceOptions.map((option) => {\n  return {\n    label: option.name,\n    value: option.voice_id,\n  }\n})\n\nconst fields: Field[] = [\n  {\n    type: 'collapsible',\n    admin: {\n      initCollapsed: false,\n    },\n    fields: [\n      {\n        name: 'stability',\n        type: 'number',\n        defaultValue: 0.5,\n        label: 'Stability',\n        max: 1,\n        min: 0,\n        required: true,\n      },\n      {\n        name: 'similarity_boost',\n        type: 'number',\n        defaultValue: 0.5,\n        label: 'Similarity Boost',\n        max: 1,\n        min: 0,\n        required: true,\n      },\n      {\n        name: 'style',\n        type: 'number',\n        defaultValue: 0.5,\n        label: 'Style',\n        max: 1,\n        min: 0,\n      },\n      {\n        name: 'use_speaker_boost',\n        type: 'checkbox',\n        label: 'Use Speaker Boost',\n      },\n    ],\n    label: 'Voice Settings',\n  },\n  {\n    name: 'seed',\n    type: 'number',\n    label: 'Seed',\n  },\n  {\n    type: 'row',\n    fields: [\n      {\n        name: 'previous_text',\n        type: 'textarea',\n        label: 'Previous Text',\n      },\n      {\n        name: 'next_text',\n        type: 'textarea',\n        label: 'Next Text',\n      },\n    ],\n  },\n]\n\nif (voiceOptions.length) {\n  fields.unshift({\n    name: 'voice_id',\n    type: 'select',\n    admin: {\n      components: {\n        Field: SelectField,\n      },\n      custom: {\n        options: voiceOptions,\n      },\n    },\n    defaultValue: voiceOptions[0]?.voice_id,\n    label: 'Voice',\n    options: fieldVoiceOptions,\n    required: true,\n    validate: () => true,\n  })\n}\n\nexport const ElevenLabsConfig: GenerationConfig = {\n  models: [\n    {\n      id: 'elevenlabs/multilingual-v2',\n      name: 'ElevenLabs Multilingual v2',\n      fields: ['upload'],\n      handler: async (text: string, options) => {\n        const voiceData = await generateVoice(text, options)\n        return {\n          data: {\n            alt: 'voice over',\n          },\n          file: {\n            name: `voice_${generateFileNameByPrompt(text)}.mp3`,\n            data: voiceData.buffer,\n            mimetype: 'audio/mp3',\n            size: voiceData.buffer.byteLength,\n          } as File,\n        }\n      },\n      output: 'audio',\n      settings: {\n        name: 'elevenlabs-multilingual-v2-settings',\n        type: 'group',\n        admin: {\n          condition: (data) => {\n            return data['model-id'] === 'elevenlabs/multilingual-v2'\n          },\n        },\n        fields,\n        label: 'ElevenLabs Multilingual v2 Settings',\n      },\n    },\n  ],\n  provider: 'ElevenLabs',\n}\n"],"names":["SelectField","generateFileNameByPrompt","generateVoice","getAllVoices","voices","voiceOptions","map","voice","label","name","value","voice_id","fieldVoiceOptions","option","fields","type","admin","initCollapsed","defaultValue","max","min","required","length","unshift","components","Field","custom","options","validate","ElevenLabsConfig","models","id","handler","text","voiceData","data","alt","file","buffer","mimetype","size","byteLength","output","settings","condition","provider"],"mappings":"AAIA,SAASA,WAAW,QAAQ,6CAA4C;AACxE,SAASC,wBAAwB,QAAQ,0CAAyC;AAClF,SAASC,aAAa,QAAQ,qBAAoB;AAClD,SAASC,YAAY,QAAQ,cAAa;AAE1C,MAAM,EAAEC,SAAS,EAAE,EAAE,GAAG,MAAMD;AAE9B,MAAME,eAAeD,OAAOE,GAAG,CAAC,CAACC;IAC/B,OAAO;QACLC,OAAOD,MAAME,IAAI;QACjBC,OAAOH,MAAMI,QAAQ;QACrB,GAAGJ,KAAK;IACV;AACF;AAEA,MAAMK,oBAAoBP,aAAaC,GAAG,CAAC,CAACO;IAC1C,OAAO;QACLL,OAAOK,OAAOJ,IAAI;QAClBC,OAAOG,OAAOF,QAAQ;IACxB;AACF;AAEA,MAAMG,SAAkB;IACtB;QACEC,MAAM;QACNC,OAAO;YACLC,eAAe;QACjB;QACAH,QAAQ;YACN;gBACEL,MAAM;gBACNM,MAAM;gBACNG,cAAc;gBACdV,OAAO;gBACPW,KAAK;gBACLC,KAAK;gBACLC,UAAU;YACZ;YACA;gBACEZ,MAAM;gBACNM,MAAM;gBACNG,cAAc;gBACdV,OAAO;gBACPW,KAAK;gBACLC,KAAK;gBACLC,UAAU;YACZ;YACA;gBACEZ,MAAM;gBACNM,MAAM;gBACNG,cAAc;gBACdV,OAAO;gBACPW,KAAK;gBACLC,KAAK;YACP;YACA;gBACEX,MAAM;gBACNM,MAAM;gBACNP,OAAO;YACT;SACD;QACDA,OAAO;IACT;IACA;QACEC,MAAM;QACNM,MAAM;QACNP,OAAO;IACT;IACA;QACEO,MAAM;QACND,QAAQ;YACN;gBACEL,MAAM;gBACNM,MAAM;gBACNP,OAAO;YACT;YACA;gBACEC,MAAM;gBACNM,MAAM;gBACNP,OAAO;YACT;SACD;IACH;CACD;AAED,IAAIH,aAAaiB,MAAM,EAAE;IACvBR,OAAOS,OAAO,CAAC;QACbd,MAAM;QACNM,MAAM;QACNC,OAAO;YACLQ,YAAY;gBACVC,OAAOzB;YACT;YACA0B,QAAQ;gBACNC,SAAStB;YACX;QACF;QACAa,cAAcb,YAAY,CAAC,EAAE,EAAEM;QAC/BH,OAAO;QACPmB,SAASf;QACTS,UAAU;QACVO,UAAU,IAAM;IAClB;AACF;AAEA,OAAO,MAAMC,mBAAqC;IAChDC,QAAQ;QACN;YACEC,IAAI;YACJtB,MAAM;YACNK,QAAQ;gBAAC;aAAS;YAClBkB,SAAS,OAAOC,MAAcN;gBAC5B,MAAMO,YAAY,MAAMhC,cAAc+B,MAAMN;gBAC5C,OAAO;oBACLQ,MAAM;wBACJC,KAAK;oBACP;oBACAC,MAAM;wBACJ5B,MAAM,CAAC,MAAM,EAAER,yBAAyBgC,MAAM,IAAI,CAAC;wBACnDE,MAAMD,UAAUI,MAAM;wBACtBC,UAAU;wBACVC,MAAMN,UAAUI,MAAM,CAACG,UAAU;oBACnC;gBACF;YACF;YACAC,QAAQ;YACRC,UAAU;gBACRlC,MAAM;gBACNM,MAAM;gBACNC,OAAO;oBACL4B,WAAW,CAACT;wBACV,OAAOA,IAAI,CAAC,WAAW,KAAK;oBAC9B;gBACF;gBACArB;gBACAN,OAAO;YACT;QACF;KACD;IACDqC,UAAU;AACZ,EAAC"}