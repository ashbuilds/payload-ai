{"version":3,"sources":["../../../../src/ai/models/openai/generateImage.ts"],"sourcesContent":["import type { ImagesResponse } from 'openai/resources/images'\n\nimport OpenAI from 'openai'\n\nimport type { GenerateImageParams } from '../../../types.js'\n\nimport { editImagesWithOpenAI } from '../../utils/editImagesWithOpenAI.js'\n\nexport const generateImage = async (\n  prompt: string,\n  {\n    images = [],\n    size = '1024x1024',\n    style = 'natural',\n    version = 'dall-e-3',\n  }: GenerateImageParams = {},\n) => {\n  const openaiAPI = new OpenAI()\n\n  const options: Record<string, any> = {}\n  if (version?.startsWith('dall')) {\n    options['response_format'] = 'b64_json'\n    options['style'] = style\n  }\n\n  let response: ImagesResponse\n  const safeVersion = version ?? undefined\n  if (images?.length) {\n    response = await editImagesWithOpenAI(images, prompt, safeVersion)\n  } else {\n    response = await openaiAPI.images.generate({\n      model: safeVersion,\n      n: 1,\n      prompt,\n      size,\n      ...options,\n    })\n  }\n\n  const dataArr = response?.data ?? []\n  const { b64_json, revised_prompt } = dataArr[0] || {}\n  return {\n    alt: revised_prompt,\n    buffer: Buffer.from(b64_json ?? '', 'base64'),\n  }\n}\n"],"names":["OpenAI","editImagesWithOpenAI","generateImage","prompt","images","size","style","version","openaiAPI","options","startsWith","response","safeVersion","undefined","length","generate","model","n","dataArr","data","b64_json","revised_prompt","alt","buffer","Buffer","from"],"mappings":"AAEA,OAAOA,YAAY,SAAQ;AAI3B,SAASC,oBAAoB,QAAQ,sCAAqC;AAE1E,OAAO,MAAMC,gBAAgB,OAC3BC,QACA,EACEC,SAAS,EAAE,EACXC,OAAO,WAAW,EAClBC,QAAQ,SAAS,EACjBC,UAAU,UAAU,EACA,GAAG,CAAC,CAAC;IAE3B,MAAMC,YAAY,IAAIR;IAEtB,MAAMS,UAA+B,CAAC;IACtC,IAAIF,SAASG,WAAW,SAAS;QAC/BD,OAAO,CAAC,kBAAkB,GAAG;QAC7BA,OAAO,CAAC,QAAQ,GAAGH;IACrB;IAEA,IAAIK;IACJ,MAAMC,cAAcL,WAAWM;IAC/B,IAAIT,QAAQU,QAAQ;QAClBH,WAAW,MAAMV,qBAAqBG,QAAQD,QAAQS;IACxD,OAAO;QACLD,WAAW,MAAMH,UAAUJ,MAAM,CAACW,QAAQ,CAAC;YACzCC,OAAOJ;YACPK,GAAG;YACHd;YACAE;YACA,GAAGI,OAAO;QACZ;IACF;IAEA,MAAMS,UAAUP,UAAUQ,QAAQ,EAAE;IACpC,MAAM,EAAEC,QAAQ,EAAEC,cAAc,EAAE,GAAGH,OAAO,CAAC,EAAE,IAAI,CAAC;IACpD,OAAO;QACLI,KAAKD;QACLE,QAAQC,OAAOC,IAAI,CAACL,YAAY,IAAI;IACtC;AACF,EAAC"}