{"version":3,"sources":["../../src/utilities/updateFieldsConfig.ts"],"sourcesContent":["import type { CollectionConfig, GlobalConfig } from 'payload'\n\ninterface UpdateFieldsConfig {\n  schemaPathMap: Record<string, string>\n  updatedCollectionConfig: CollectionConfig | GlobalConfig\n}\n\nexport const updateFieldsConfig = (collectionConfig: CollectionConfig | GlobalConfig): UpdateFieldsConfig => {\n  let schemaPathMap = {}\n\n  function updateField(field: any, parentPath = ''): any {\n    const currentPath = parentPath ? `${parentPath}.${field.name}` : field.name\n    const currentSchemaPath = `${collectionConfig.slug}.${currentPath}`\n\n    // Disabled fields/ field types\n    if (\n      field.admin?.disabled ||\n      field.admin?.readOnly ||\n      field.admin?.hidden ||\n      field.type === 'row'\n    ) {\n      return field\n    }\n\n    // Map field path for global fieldInstructionsMap to load related instructions\n    // This is done due to save extra API call to get instructions when Field components are loaded in admin\n    // Doing is will only call instructions data when user clicks on settings\n    if (['richText', 'text', 'textarea', 'upload'].includes(field.type)) {\n      schemaPathMap = {\n        ...schemaPathMap,\n        [currentSchemaPath]: {\n          type: field.type,\n          label: field.label || field.name,\n          relationTo: field.relationTo,\n        },\n      }\n    }\n\n    // Inject AI actions, richText is not included here as it has to be explicitly defined by user\n    if (['text', 'textarea', 'upload'].includes(field.type)) {\n      let customField = {}\n\n      // Custom fields don't fully adhere to the Payload schema, making it difficult to\n      // determine which components support injecting ComposeField as a Description.\n      if (field.admin?.components?.Field || field.admin?.components?.Description) {\n        // TODO: If a field already provides its own Description, we still inject our ComposeField\n        // by overriding Description. If you need both, consider composing your own wrapper.\n        customField = {}\n      }\n\n      return {\n        ...field,\n        admin: {\n          ...field.admin,\n          components: {\n            ...(field.admin?.components || {}),\n            Description: {\n              clientProps: {\n                schemaPath: currentSchemaPath,\n              },\n              path: '@ai-stack/payloadcms/fields#ComposeField',\n            },\n            ...customField,\n          },\n        },\n      }\n    }\n\n    if (field.fields) {\n      return {\n        ...field,\n        fields: field.fields.map((subField: any) => updateField(subField, currentPath)),\n      }\n    }\n\n    if (field.tabs) {\n      return {\n        ...field,\n        tabs: field.tabs.map((tab: any) => {\n          return {\n            ...tab,\n            // Tabs are a UI construct and should not add to the schema path\n            fields: (tab.fields || []).map((subField: any) => updateField(subField, parentPath)),\n          }\n        }),\n      }\n    }\n\n    if (field.blocks) {\n      return {\n        ...field,\n        blocks: field.blocks.map((block: any) => ({\n          ...block,\n          fields: block.fields.map((subField: any) =>\n            updateField(subField, `${currentPath}.${block.slug}`),\n          ),\n        })),\n      }\n    }\n\n    return field\n  }\n\n  const updatedCollectionConfig = {\n    ...collectionConfig,\n    fields: collectionConfig.fields.map((field) => updateField(field)),\n  }\n\n  return {\n    schemaPathMap,\n    updatedCollectionConfig,\n  }\n}\n"],"names":["updateFieldsConfig","collectionConfig","schemaPathMap","updateField","field","parentPath","currentPath","name","currentSchemaPath","slug","admin","disabled","readOnly","hidden","type","includes","label","relationTo","customField","components","Field","Description","clientProps","schemaPath","path","fields","map","subField","tabs","tab","blocks","block","updatedCollectionConfig"],"mappings":"AAOA,OAAO,MAAMA,qBAAqB,CAACC;IACjC,IAAIC,gBAAgB,CAAC;IAErB,SAASC,YAAYC,KAAU,EAAEC,aAAa,EAAE;QAC9C,MAAMC,cAAcD,aAAa,GAAGA,WAAW,CAAC,EAAED,MAAMG,IAAI,EAAE,GAAGH,MAAMG,IAAI;QAC3E,MAAMC,oBAAoB,GAAGP,iBAAiBQ,IAAI,CAAC,CAAC,EAAEH,aAAa;QAEnE,+BAA+B;QAC/B,IACEF,MAAMM,KAAK,EAAEC,YACbP,MAAMM,KAAK,EAAEE,YACbR,MAAMM,KAAK,EAAEG,UACbT,MAAMU,IAAI,KAAK,OACf;YACA,OAAOV;QACT;QAEA,8EAA8E;QAC9E,wGAAwG;QACxG,yEAAyE;QACzE,IAAI;YAAC;YAAY;YAAQ;YAAY;SAAS,CAACW,QAAQ,CAACX,MAAMU,IAAI,GAAG;YACnEZ,gBAAgB;gBACd,GAAGA,aAAa;gBAChB,CAACM,kBAAkB,EAAE;oBACnBM,MAAMV,MAAMU,IAAI;oBAChBE,OAAOZ,MAAMY,KAAK,IAAIZ,MAAMG,IAAI;oBAChCU,YAAYb,MAAMa,UAAU;gBAC9B;YACF;QACF;QAEA,8FAA8F;QAC9F,IAAI;YAAC;YAAQ;YAAY;SAAS,CAACF,QAAQ,CAACX,MAAMU,IAAI,GAAG;YACvD,IAAII,cAAc,CAAC;YAEnB,iFAAiF;YACjF,8EAA8E;YAC9E,IAAId,MAAMM,KAAK,EAAES,YAAYC,SAAShB,MAAMM,KAAK,EAAES,YAAYE,aAAa;gBAC1E,0FAA0F;gBAC1F,oFAAoF;gBACpFH,cAAc,CAAC;YACjB;YAEA,OAAO;gBACL,GAAGd,KAAK;gBACRM,OAAO;oBACL,GAAGN,MAAMM,KAAK;oBACdS,YAAY;wBACV,GAAIf,MAAMM,KAAK,EAAES,cAAc,CAAC,CAAC;wBACjCE,aAAa;4BACXC,aAAa;gCACXC,YAAYf;4BACd;4BACAgB,MAAM;wBACR;wBACA,GAAGN,WAAW;oBAChB;gBACF;YACF;QACF;QAEA,IAAId,MAAMqB,MAAM,EAAE;YAChB,OAAO;gBACL,GAAGrB,KAAK;gBACRqB,QAAQrB,MAAMqB,MAAM,CAACC,GAAG,CAAC,CAACC,WAAkBxB,YAAYwB,UAAUrB;YACpE;QACF;QAEA,IAAIF,MAAMwB,IAAI,EAAE;YACd,OAAO;gBACL,GAAGxB,KAAK;gBACRwB,MAAMxB,MAAMwB,IAAI,CAACF,GAAG,CAAC,CAACG;oBACpB,OAAO;wBACL,GAAGA,GAAG;wBACN,gEAAgE;wBAChEJ,QAAQ,AAACI,CAAAA,IAAIJ,MAAM,IAAI,EAAE,AAAD,EAAGC,GAAG,CAAC,CAACC,WAAkBxB,YAAYwB,UAAUtB;oBAC1E;gBACF;YACF;QACF;QAEA,IAAID,MAAM0B,MAAM,EAAE;YAChB,OAAO;gBACL,GAAG1B,KAAK;gBACR0B,QAAQ1B,MAAM0B,MAAM,CAACJ,GAAG,CAAC,CAACK,QAAgB,CAAA;wBACxC,GAAGA,KAAK;wBACRN,QAAQM,MAAMN,MAAM,CAACC,GAAG,CAAC,CAACC,WACxBxB,YAAYwB,UAAU,GAAGrB,YAAY,CAAC,EAAEyB,MAAMtB,IAAI,EAAE;oBAExD,CAAA;YACF;QACF;QAEA,OAAOL;IACT;IAEA,MAAM4B,0BAA0B;QAC9B,GAAG/B,gBAAgB;QACnBwB,QAAQxB,iBAAiBwB,MAAM,CAACC,GAAG,CAAC,CAACtB,QAAUD,YAAYC;IAC7D;IAEA,OAAO;QACLF;QACA8B;IACF;AACF,EAAC"}