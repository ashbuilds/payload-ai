{"version":3,"sources":["../../src/utilities/updateFieldsConfig.ts"],"sourcesContent":["import type { CollectionConfig } from 'payload'\n\nimport { DescriptionField } from '../fields/DescriptionField/DescriptionField.js'\n\ninterface UpdateFieldsConfig {\n  schemaPathMap: Record<string, string>\n  updatedCollectionConfig: CollectionConfig\n}\n\nexport const updateFieldsConfig = (collectionConfig: CollectionConfig): UpdateFieldsConfig => {\n  let schemaPathMap = {}\n  function updateField(field: any, parentPath = ''): any {\n    const currentPath = parentPath ? `${parentPath}.${field.name}` : field.name\n    const currentSchemaPath = `${collectionConfig.slug}.${currentPath}`\n\n    if (field.admin?.disabled || field.admin?.readOnly || field.admin?.hidden) {\n      return field\n    }\n\n    // Map field path for global fieldInstructionsMap to load related instructions\n    // This is done due to save extra API call to get instructions when Field components are loaded in admin\n    // Doing is will only call instructions data when user clicks on settings\n    if (['richText', 'text', 'textarea', 'upload'].includes(field.type)) {\n      schemaPathMap = {\n        ...schemaPathMap,\n        [currentSchemaPath]: {\n          type: field.type,\n          label: field.label || field.name,\n        }, // TODO add field name to support seed time prompt generation\n      }\n    }\n\n    // Inject AI actions, richText is not included here as it has to be explicitly defined by user\n    if (['text', 'textarea', 'upload'].includes(field.type)) {\n      return {\n        ...field,\n        admin: {\n          ...field.admin,\n          components: {\n            ...(field.admin?.components || {}),\n            // @ts-expect-error\n            Description: DescriptionField({\n              Description: field.admin?.components?.Description,\n            }),\n          },\n        },\n      }\n    }\n\n    if (field.fields) {\n      return {\n        ...field,\n        fields: field.fields.map((subField: any) => updateField(subField, currentPath)),\n      }\n    }\n\n    if (field.tabs) {\n      return {\n        ...field,\n        tabs: field.tabs.map((tab: any) => ({\n          ...tab,\n          fields: tab.fields.map((subField: any) => updateField(subField, currentPath)),\n        })),\n      }\n    }\n\n    if (field.blocks) {\n      return {\n        ...field,\n        blocks: field.blocks.map((block: any) => ({\n          ...block,\n          fields: block.fields.map((subField: any) =>\n            updateField(subField, `${currentPath}.${block.slug}`),\n          ),\n        })),\n      }\n    }\n\n    return field\n  }\n\n  const updatedCollectionConfig = {\n    ...collectionConfig,\n    fields: collectionConfig.fields.map((field) => updateField(field)),\n  }\n\n  return {\n    schemaPathMap,\n    updatedCollectionConfig,\n  }\n}\n"],"names":["DescriptionField","updateFieldsConfig","collectionConfig","schemaPathMap","updateField","field","parentPath","currentPath","name","currentSchemaPath","slug","admin","disabled","readOnly","hidden","includes","type","label","components","Description","fields","map","subField","tabs","tab","blocks","block","updatedCollectionConfig"],"mappings":"AAEA,SAASA,gBAAgB,QAAQ,iDAAgD;AAOjF,OAAO,MAAMC,qBAAqB,CAACC;IACjC,IAAIC,gBAAgB,CAAC;IACrB,SAASC,YAAYC,KAAU,EAAEC,aAAa,EAAE;QAC9C,MAAMC,cAAcD,aAAa,CAAC,EAAEA,WAAW,CAAC,EAAED,MAAMG,IAAI,CAAC,CAAC,GAAGH,MAAMG,IAAI;QAC3E,MAAMC,oBAAoB,CAAC,EAAEP,iBAAiBQ,IAAI,CAAC,CAAC,EAAEH,YAAY,CAAC;QAEnE,IAAIF,MAAMM,KAAK,EAAEC,YAAYP,MAAMM,KAAK,EAAEE,YAAYR,MAAMM,KAAK,EAAEG,QAAQ;YACzE,OAAOT;QACT;QAEA,8EAA8E;QAC9E,wGAAwG;QACxG,yEAAyE;QACzE,IAAI;YAAC;YAAY;YAAQ;YAAY;SAAS,CAACU,QAAQ,CAACV,MAAMW,IAAI,GAAG;YACnEb,gBAAgB;gBACd,GAAGA,aAAa;gBAChB,CAACM,kBAAkB,EAAE;oBACnBO,MAAMX,MAAMW,IAAI;oBAChBC,OAAOZ,MAAMY,KAAK,IAAIZ,MAAMG,IAAI;gBAClC;YACF;QACF;QAEA,8FAA8F;QAC9F,IAAI;YAAC;YAAQ;YAAY;SAAS,CAACO,QAAQ,CAACV,MAAMW,IAAI,GAAG;YACvD,OAAO;gBACL,GAAGX,KAAK;gBACRM,OAAO;oBACL,GAAGN,MAAMM,KAAK;oBACdO,YAAY;wBACV,GAAIb,MAAMM,KAAK,EAAEO,cAAc,CAAC,CAAC;wBACjC,mBAAmB;wBACnBC,aAAanB,iBAAiB;4BAC5BmB,aAAad,MAAMM,KAAK,EAAEO,YAAYC;wBACxC;oBACF;gBACF;YACF;QACF;QAEA,IAAId,MAAMe,MAAM,EAAE;YAChB,OAAO;gBACL,GAAGf,KAAK;gBACRe,QAAQf,MAAMe,MAAM,CAACC,GAAG,CAAC,CAACC,WAAkBlB,YAAYkB,UAAUf;YACpE;QACF;QAEA,IAAIF,MAAMkB,IAAI,EAAE;YACd,OAAO;gBACL,GAAGlB,KAAK;gBACRkB,MAAMlB,MAAMkB,IAAI,CAACF,GAAG,CAAC,CAACG,MAAc,CAAA;wBAClC,GAAGA,GAAG;wBACNJ,QAAQI,IAAIJ,MAAM,CAACC,GAAG,CAAC,CAACC,WAAkBlB,YAAYkB,UAAUf;oBAClE,CAAA;YACF;QACF;QAEA,IAAIF,MAAMoB,MAAM,EAAE;YAChB,OAAO;gBACL,GAAGpB,KAAK;gBACRoB,QAAQpB,MAAMoB,MAAM,CAACJ,GAAG,CAAC,CAACK,QAAgB,CAAA;wBACxC,GAAGA,KAAK;wBACRN,QAAQM,MAAMN,MAAM,CAACC,GAAG,CAAC,CAACC,WACxBlB,YAAYkB,UAAU,CAAC,EAAEf,YAAY,CAAC,EAAEmB,MAAMhB,IAAI,CAAC,CAAC;oBAExD,CAAA;YACF;QACF;QAEA,OAAOL;IACT;IAEA,MAAMsB,0BAA0B;QAC9B,GAAGzB,gBAAgB;QACnBkB,QAAQlB,iBAAiBkB,MAAM,CAACC,GAAG,CAAC,CAAChB,QAAUD,YAAYC;IAC7D;IAEA,OAAO;QACLF;QACAwB;IACF;AACF,EAAC"}