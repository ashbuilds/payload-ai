{"version":3,"sources":["../../src/utilities/useDotFields.ts"],"sourcesContent":["import { useFieldProps, useForm } from '@payloadcms/ui'\nimport dot from 'dot-object'\nimport { useCallback, useEffect, useState } from 'react'\n\nimport { arraysHaveSameStrings } from './arraysHaveSameStrings.js'\n\ninterface DotFields {\n  dotFields: Record<string, unknown>\n  fields: Record<string, unknown>\n  getDotFields: () => Record<string, unknown>\n}\n\n// TODO: Refactor this to be a generic way of getting merged data of sibling fields and its keys with dot notation\nexport const useDotFields = (): DotFields => {\n  const { getData, getFields, getSiblingData } = useForm()\n  const { path } = useFieldProps()\n\n  const [fieldsInfo, setFieldsInfo] = useState<DotFields>({\n    dotFields: null,\n    fields: null,\n    getDotFields: () => ({}),\n  })\n\n  // TODO: I think this needs to be disabled for rich text fields, its currently throwing error in vercel\n  const getDotFields = useCallback((): {\n    dotFields: Record<string, unknown>\n    fields: Record<string, unknown>\n  } => {\n    if (typeof getData !== 'function') return { dotFields: {}, fields: {} }\n\n    const data = getData()\n    if (Object.keys(data).length === 0) return { dotFields: {}, fields: {} }\n\n    const siblingData = getSiblingData(path)\n    console.log('siblingData : ', siblingData)\n    console.log('data : ', data)\n\n    const dataDot = dot.dot(data)\n    const siblingDataDot = dot.dot(siblingData)\n\n    if (arraysHaveSameStrings(Object.keys(dataDot), Object.keys(siblingDataDot))) {\n      return {\n        dotFields: { ...dataDot },\n        fields: { ...data },\n      }\n    } else {\n      const siblingDataDot = dot.dot({ sibling: siblingData })\n      return {\n        dotFields: { ...dataDot, ...siblingDataDot },\n        fields: { ...data, sibling: siblingData },\n      }\n    }\n  }, [getFields, getSiblingData, path, getData, fieldsInfo])\n\n  useEffect(() => {\n    if (fieldsInfo.dotFields) {\n      return\n    }\n\n    const updatedFields = getDotFields()\n    setFieldsInfo({\n      dotFields: updatedFields.dotFields,\n      fields: updatedFields.fields,\n      getDotFields,\n    })\n  }, [getDotFields, fieldsInfo])\n\n  return { ...fieldsInfo, getDotFields }\n}\n"],"names":["useFieldProps","useForm","dot","useCallback","useEffect","useState","arraysHaveSameStrings","useDotFields","getData","getFields","getSiblingData","path","fieldsInfo","setFieldsInfo","dotFields","fields","getDotFields","data","Object","keys","length","siblingData","console","log","dataDot","siblingDataDot","sibling","updatedFields"],"mappings":"AAAA,SAASA,aAAa,EAAEC,OAAO,QAAQ,iBAAgB;AACvD,OAAOC,SAAS,aAAY;AAC5B,SAASC,WAAW,EAAEC,SAAS,EAAEC,QAAQ,QAAQ,QAAO;AAExD,SAASC,qBAAqB,QAAQ,6BAA4B;AAQlE,kHAAkH;AAClH,OAAO,MAAMC,eAAe;IAC1B,MAAM,EAAEC,OAAO,EAAEC,SAAS,EAAEC,cAAc,EAAE,GAAGT;IAC/C,MAAM,EAAEU,IAAI,EAAE,GAAGX;IAEjB,MAAM,CAACY,YAAYC,cAAc,GAAGR,SAAoB;QACtDS,WAAW;QACXC,QAAQ;QACRC,cAAc,IAAO,CAAA,CAAC,CAAA;IACxB;IAEA,uGAAuG;IACvG,MAAMA,eAAeb,YAAY;QAI/B,IAAI,OAAOK,YAAY,YAAY,OAAO;YAAEM,WAAW,CAAC;YAAGC,QAAQ,CAAC;QAAE;QAEtE,MAAME,OAAOT;QACb,IAAIU,OAAOC,IAAI,CAACF,MAAMG,MAAM,KAAK,GAAG,OAAO;YAAEN,WAAW,CAAC;YAAGC,QAAQ,CAAC;QAAE;QAEvE,MAAMM,cAAcX,eAAeC;QACnCW,QAAQC,GAAG,CAAC,kBAAkBF;QAC9BC,QAAQC,GAAG,CAAC,WAAWN;QAEvB,MAAMO,UAAUtB,IAAIA,GAAG,CAACe;QACxB,MAAMQ,iBAAiBvB,IAAIA,GAAG,CAACmB;QAE/B,IAAIf,sBAAsBY,OAAOC,IAAI,CAACK,UAAUN,OAAOC,IAAI,CAACM,kBAAkB;YAC5E,OAAO;gBACLX,WAAW;oBAAE,GAAGU,OAAO;gBAAC;gBACxBT,QAAQ;oBAAE,GAAGE,IAAI;gBAAC;YACpB;QACF,OAAO;YACL,MAAMQ,iBAAiBvB,IAAIA,GAAG,CAAC;gBAAEwB,SAASL;YAAY;YACtD,OAAO;gBACLP,WAAW;oBAAE,GAAGU,OAAO;oBAAE,GAAGC,cAAc;gBAAC;gBAC3CV,QAAQ;oBAAE,GAAGE,IAAI;oBAAES,SAASL;gBAAY;YAC1C;QACF;IACF,GAAG;QAACZ;QAAWC;QAAgBC;QAAMH;QAASI;KAAW;IAEzDR,UAAU;QACR,IAAIQ,WAAWE,SAAS,EAAE;YACxB;QACF;QAEA,MAAMa,gBAAgBX;QACtBH,cAAc;YACZC,WAAWa,cAAcb,SAAS;YAClCC,QAAQY,cAAcZ,MAAM;YAC5BC;QACF;IACF,GAAG;QAACA;QAAcJ;KAAW;IAE7B,OAAO;QAAE,GAAGA,UAAU;QAAEI;IAAa;AACvC,EAAC"}